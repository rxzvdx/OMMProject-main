{% extends 'home.html' %}

{% block content %}
<form method="POST" action = "{{ url_for('createTest') }} ">
    <div class="container-fluid mx-0" style="padding-left: 20%;" method="POST" action="{{ url_for('createTest') }}">
        <div class="row">
            <div class="col-md-9">
                <h2>Test Details</h2>
                    <div class="row-mx-4 d-flex justify-content-left">
                        <div class="col-md-3">
                            <div class="form-check mx-4">
                                <input class="form-check-input" type="checkbox" id="radio1" name="timedTest" value="option1">
                                <label class="form-check-label" for="radio1">Timed</label>
                            </div>
                            <div class="space"></div>
                            <div class="form-check mx-4">
                                <input class="form-check-input" type="checkbox" id="radio2" name="tutoredTest" value="option2">
                                <label class="form-check-label" for="radio2">Tutored</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <h2 style="font-size: 1rem;">Number of Questions<br>(Max of 40)</h2>
                            <input type="number" class="form-control" id="numberInput" name="numberInput" min="1" max="40" style="width: 150px;">
                        </div>
                        <div class="space">
                        </div>
                        <div class="col-md-6">
                            <h2 style="font-size: 1rem;">Name of test<br>(Optional)</h2>
                            <input type="text" class="form-control" id="testNameInput" name="testNameInput" style="width: 300px;">
                        </div>
                        <div class="space"></div>
                    </div>
                </div>
            </div>
            
        <div class="line mt-3 mb-3"></div>
           
        <div class="row">
            <div class="col-md-9">
                <h2>Choose your Subjects</h2>
                <div class="options-container">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject1" name="category" value="anatomy">
                        <label class="form-check-label" for="subject1">Anatomy</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject1" name="category" value="autonomics">
                        <label class="form-check-label" for="subject2">Autonomics</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject3" name="category" value="biomechanics">
                        <label class="form-check-label" for="subject3">Bio Mechanics</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject4" name="category" value="lymphatics">
                        <label class="form-check-label" for="subject4">Lymphatics</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject5" name="category" value="heent">
                        <label class="form-check-label" for="subject5">H.E.E.N.T</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject6" name="category" value="cardiopulmonary">
                        <label class="form-check-label" for="subject6">Cardiopulmonary</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject7" name="category" value="gastrointestinal">
                        <label class="form-check-label" for="subject7">Gastrointestinal</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject8" name="category" value="pregnancy">
                        <label class="form-check-label" for="subject8">Pregnancy</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject9" name="category" value="pediatrics">
                        <label class="form-check-label" for="subject9">Pediatrics</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="subject10" name="category" value="orthopedic/gaint">
                        <label class="form-check-label" for="subject10">Orthopedics/Gait</label>
                        </div>
                    </div>
                    <div class="row-mx-4 d-flex justify-content-left">
                        <button class="btn btn-primary mt-3" id="selectAllSubjectsBtn" type="button">Select All Subjects</button>
                        <span class="error-text" id="errorMsg1"></span>
                    </div>
                </div>
            </div>
            
            <div class="line mt-3 mb-3"></div>

            <div class="col-md-9">
                <h2>Choose your Body Regions</h2>
                <div class="options-container">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag1" name="bodyRegion" value="head">
                        <label class="form-check-label" for="subject1">Head</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag2" name="bodyRegion" value="cervical">
                        <label class="form-check-label" for="subject2">Cervical</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag3" name="bodyRegion" value="thoracic">
                        <label class="form-check-label" for="subject3">Thoracic</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag4" name="bodyRegion" value="lumbar">
                        <label class="form-check-label" for="subject4">Lumbar</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag5" name="bodyRegion" value="pelvis">
                        <label class="form-check-label" for="subject5">Pelvis</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag6" name="bodyRegion" value="sacrum">
                        <label class="form-check-label" for="subject6">Sacrum</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag7" name="bodyRegion" value="lowerextremity">
                        <label class="form-check-label" for="subject7">Lower Extremity</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag8" name="bodyRegion" value="upperextremity">
                        <label class="form-check-label" for="subject8">Upper Extremity</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag9" name="bodyRegion" value="ribs">
                        <label class="form-check-label" for="subject9">Ribs</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="tag10" name="bodyRegion" value="abdomen">
                        <label class="form-check-label" for="subject10">Abdomen</label>
                    </div>
                </div>
                <div class="row-mx-4 d-flex justify-content-left">
                    <button class="btn btn-primary mt-3" id="selectAllBodyBtn" type="button">Select All Body Regions</button>
                    <span class="error-text" id="errorMsg2"></span>
                </div>
            </div>
            
            <div class="line mt-3 mb-3"></div>

            <div class="col-md-9">
                <h2>Choose your Treatment Techniques</h2>
                <div class="options-container">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique1" name="technique" value="myofascial release (MFR)/soft tissue (ST)">
                        <label class="form-check-label" for="subject1">Myofascial release (MFR)/Soft tissue (ST)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique2" name="technique" value="muscle energy (ME)">
                        <label class="form-check-label" for="subject2">Muscle energy (ME)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique3" name="technique" value="high-velocity low-amplitude (HVLA)">
                        <label class="form-check-label" for="subject3">High-velocity low-amplitude (HVLA)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique4" name="technique" value="counterstrain (CS)">
                        <label class="form-check-label" for="subject4">Counterstrain (CS)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique5" name="technique" value="facilitated positional release (FPR)">
                        <label class="form-check-label" for="subject5">Facilitated positional release (FPR)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique6" name="technique" value="balanced ligamentous tension (BLT)">
                        <label class="form-check-label" for="subject6">Balanced ligamentous tension (BLT)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique7" name="technique" value="still technique">
                        <label class="form-check-label" for="subject7">Still technique</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique8" name="technique" value="cranial techniques">
                        <label class="form-check-label" for="subject8">Cranial techniques</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique9" name="technique" value="lymphatics techniques">
                        <label class="form-check-label" for="subject9">Lymphatics techniques</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique10" name="technique" value="mechanism of action (MOA)">
                        <label class="form-check-label" for="subject10">Mechanism of action (MOA)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="technique11" name="technique" value="indications/contraindications to treatment">
                        <label class="form-check-label" for="subject11">Indications/Contraindications to Treatment</label>
                    </div>
                </div>
                <div class="row-mx-4 d-flex justify-content-left">
                    <button class="btn btn-primary mt-3 mb-10" id="selectAllTechniqueBtn" type="button" style="margin-bottom: 20px;">Select All Treatment Techniques</button>
                    <span class="error-text" id="errorMsg3"></span>
                </div>
            </div>
        </div>
        <button class="createTestBtn" id="takeTestBtn" type="submit" name='buttonID' style="position: fixed; bottom: 20px; right: 30px; width: 200px; height: 50px; background-color: #28a745; color: white;">Create Test</button>
    </div>
</form>

<style>
    /* Add your custom CSS styles here */
    .container-fluid {
        position: relative;
        height: 100vh;
        width: 100vw;
        padding: 10px
    }
    
    .space {
        padding: 10px
    }
    
    .line {
        width: 90%;
        margin: 0 auto;
        border-top: 2px solid black;
        transform: translateX(-5%);
    }
    
    .error-text {
        font-size: 16px;
        color: #Ff0000;
        line-height: 1.5;
        font-family: Arial, sans-serif;
        margin-bottom: 5px;
        margin-top: 28px;
        margin-left: 20px;
    }
    
    .options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        gap: 12px;
        width: 100%;
        box-sizing: border-box;
    }

    .form-check {
        flex: 1 1 150px;
        max-width: 200px;
    }
    
    body {
        background-color: #e0e0e0;
    }

    
</style>

<script>
    let selectAllSubjectsState = false;
    let selectAllBodyRegionState = false;
    let selectAllTechniquesState = false;
    
    const buttonSub = document.getElementById('selectAllSubjectsBtn');
    const buttonBody = document.getElementById('selectAllBodyBtn');
    const buttonTech = document.getElementById('selectAllTechniqueBtn');

    function toggleSubjectsCheckboxes() {
        const checkboxes = document.querySelectorAll('.form-check-input[type="checkbox"][name="category"]');
        checkboxes.forEach(function (checkbox) {
            checkbox.checked = !selectAllSubjectsState;
        });
        
        if (!selectAllSubjectsState) {
            buttonSub.innerHTML = 'Deselect All Subjects';
        } else {
            buttonSub.innerHTML = 'Select All Subjects';
        }
        
        selectAllSubjectsState = !selectAllSubjectsState;
    }

    function toggleBodyRegionCheckboxes() {
        const checkboxes = document.querySelectorAll('.form-check-input[type="checkbox"][name="bodyRegion"]');
        checkboxes.forEach(function (checkbox) {
            checkbox.checked = !selectAllBodyRegionState;
        });
        
        if (!selectAllBodyRegionState) {
            buttonBody.innerHTML = 'Deselect All Body Regions';
        } else {
            buttonBody.innerHTML = 'Select All Body Regions';
        }
        
        selectAllBodyRegionState = !selectAllBodyRegionState;
    }

    function toggleTechniquesCheckboxes() {
        const checkboxes = document.querySelectorAll('.form-check-input[type="checkbox"][name="technique"]');
        checkboxes.forEach(function (checkbox) {
            checkbox.checked = !selectAllTechniquesState;
        });
        
        if (!selectAllTechniquesState) {
            buttonTech.innerHTML = 'Deselect All Treatment Techniques';
        } else {
            buttonTech.innerHTML = 'Select All Treatment Techniques';
        }
        
        selectAllTechniquesState = !selectAllTechniquesState;
    }

document.getElementById('selectAllSubjectsBtn').addEventListener('click', toggleSubjectsCheckboxes);
document.getElementById('selectAllBodyBtn').addEventListener('click', toggleBodyRegionCheckboxes);
document.getElementById('selectAllTechniqueBtn').addEventListener('click', toggleTechniquesCheckboxes);

const numberInput = document.getElementById('numberInput');
const takeTestButton = document.getElementById('takeTestBtn');
numberInput.value = 5;

numberInput.addEventListener('keydown', function (event) {
    const allowedKeys = ['Backspace', 'ArrowLeft', 'ArrowRight', 'Delete']; // Allow navigation and editing keys
    const isNumberKey = event.key.match(/[0-9]/); // Check if the key is a number

    if (!isNumberKey && !allowedKeys.includes(event.key)) {
        event.preventDefault(); // Block anything that's not a number or allowed key
    }
});

// Add an event listener to validate the value during input
numberInput.addEventListener('input', function () {
    let value = parseInt(numberInput.value, 10);

    // Ensure the value is within the range
    if (value > numberInput.max) {
        numberInput.value = numberInput.max; // Set to max if greater
    } else if (numberInput.min > value || isNan(value)) {
        numberInput.value = numberInput.min; // Set to min if less or invalid
    }
});

// Prevent blank textbox on blur
numberInput.addEventListener('blur', function () {
    if (!numberInput.value) {
        numberInput.value = numberInput.min; // Default to min when input is blank
    }
});


takeTestBtn.addEventListener('click', function(event) {
    const subjectCheckboxes = document.querySelectorAll('.form-check-input[type="checkbox"][name="category"]:checked');
    const bodyRegionCheckboxes = document.querySelectorAll('.form-check-input[type="checkbox"][name="bodyRegion"]:checked');
    const techniqueCheckboxes = document.querySelectorAll('.form-check-input[type="checkbox"][name="technique"]:checked');

    const errorMsg1 = document.getElementById('errorMsg1');
    const errorMsg2 = document.getElementById('errorMsg2');
    const errorMsg3 = document.getElementById('errorMsg3');

    let createTest = true;

    if (subjectCheckboxes.length === 0) {
        createTest = false;
        errorMsg1.textContent = "Please select at least one of the following subjects!";
    } else {
        errorMsg1.textContent = "";
    }

    if (bodyRegionCheckboxes.length === 0) {
        createTest = false;
        errorMsg2.textContent = "Please select at least one of the following body regions!";
    } else {
        errorMsg2.textContent = "";
    }

    if (techniqueCheckboxes.length === 0) {
        createTest = false;
        errorMsg3.textContent = "Please select at least one of the following techniques!";
    } else {
        errorMsg3.textContent = "";
    }

    if (!createTest) {
        event.preventDefault();
    }
});

</script>

{% endblock %}
